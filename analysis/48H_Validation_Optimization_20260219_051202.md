# 48H Validation Optimization — 2026-02-19

## 현재 상황 (2026-02-19 05:00 UTC 기준)

### 드라이런 첫 스캔 결과
| 항목 | NBA | NHL | 합계 |
|------|-----|-----|------|
| 마켓 발견 | 639 | 245 | **884** |
| Odds API 매칭 | 52 (8.1%) | 37 (15.1%) | **89** |
| Edge ≥ 3% | 29 (55.8%) | 22 (59.5%) | **51** |
| 실제 진입 | 10 | 8 | **18** |
| 배치액 | $403 | $329 | **$732** |

### 진입을 막은 병목 (51 edges → 18 trades)
| 병목 | 차단 건수 | 비율 |
|------|----------|------|
| max_entries_per_cycle=10 | ~10 | 19.6% |
| F-023 이벤트 중복 (같은 경기 spread/OU) | ~12 | 23.5% |
| P0-1 가격 하한 ($0.35 미만) | ~4 | 7.8% |
| per_game cap ($500) | ~2 | 3.9% |
| **daily cap 후 차단** | ~5 | 9.8% |

### 현재 포지션 정산 타임라인
| 날짜 | 포지션 수 | 배치액 | 진입 후 경과 |
|------|----------|--------|-------------|
| Feb 20 (내일) | 8 | $161 | ~20H |
| Feb 21 | 5 | $160 | ~40H |
| Feb 22 | 8 | $341 | ~65H |
| Feb 26-27 | 8 | $338 | 4-5일 |

**문제**: $338 (34%)이 4-5일 후 정산 → 48H 검증에 포함 안됨

---

## 48H 검증에 필요한 조건

### 통계적 유의성
| 정산 건수 | 신뢰 수준 | 판단 가능 여부 |
|----------|----------|--------------|
| 10건 | 낮음 | 방향성만 확인 |
| 20건 | 중간 | 승률 트렌드 파악 |
| **30건** | **괜찮음** | **Go/No-Go 결정 가능** |
| 50건 | 높음 | ROI 정밀 측정 |

### 48H 내 정산 가능한 경기 수 (추정)
- **Feb 19 밤 (오늘)**: NBA 8-10경기 + NHL 5-7경기 = 13-17경기
- **Feb 20 밤 (내일)**: NBA 6-8경기 + NHL 4-6경기 = 10-14경기
- **합계**: **23-31 경기** → 마켓 수로는 **50-80개** (moneyline + 1H + spread + OU)

### 핵심 공식
```
48H 내 정산 건수 = (일일 진입 건수) × 2일 × (48H 내 정산 비율)
```
현재: 18건 × 1일 × 66% = **~12건** (부족)
목표: **30건 이상**

---

## 권장 설정

### Option A: 보수적 ($3,000 / $1,500)
```
POLY24H_BANKROLL=3000
POLY24H_MAX_DAILY_DEPLOYMENT_USD=1500
POLY24H_MAX_POSITION_USD=50
```
- 예상 일일 진입: ~25건 × $50 = $1,250
- 48H 정산: ~25 × 2 × 0.66 = **33건** ✓
- Odds API: 200 남음 → 일 4-5회 fetch, 충분

### Option B: 공격적 ($5,000 / $3,000) ← 권장
```
POLY24H_BANKROLL=5000
POLY24H_MAX_DAILY_DEPLOYMENT_USD=3000
POLY24H_MAX_POSITION_USD=50
```
- 예상 일일 진입: ~35건 × $50 = $1,750
- 48H 정산: ~35 × 2 × 0.66 = **46건** ✓✓
- 잔여 한도가 NHL까지 충분히 커버
- paper trading이므로 실제 자금 위험 없음

### 추가 코드 변경 필요 (F-029)

현재 코드에 3가지 병목이 있어서 설정만 바꿔서는 진입 건수가 크게 늘지 않음:

#### 병목 1: `max_entries_per_cycle = 10` (하드코딩)
- `event_scheduler.py`에서 PositionManager 생성 시 기본값 10
- env var로 오버라이드 안됨
- **수정**: env var `POLY24H_MAX_ENTRIES_PER_CYCLE` 추가

#### 병목 2: F-023 이벤트 중복 방지 (같은 경기 spread/OU 차단)
- 같은 경기의 moneyline, spread, OU 중 1개만 진입 허용
- **수정 불필요** — 라이브에서도 유지해야 할 규칙

#### 병목 3: P0-1 가격 하한 ($0.35)
- 저가 마켓(큰 언더독) 필터링 — 합리적이지만 기회 제한
- **수정 옵션**: $0.25로 하향 → ~4건 추가

### 예상 결과 (Option B + 병목 해소)

| 항목 | 현재 | 변경 후 |
|------|------|---------|
| 일일 진입 | ~18건 | **~35-40건** |
| 일일 배치 | $879 | **$1,750-2,000** |
| 48H 정산 | ~12건 | **~46-53건** |
| 검증 충분성 | 부족 | **충분 (50건)** |
| Odds API 소모 | 8/일 | 8/일 (동일) |

---

## 리스크 참고

이 설정은 **paper trading 전용**. 라이브 전환 시:
- 실제 뱅크롤 $900에 맞춰 재조정 필요
- max_per_market $50 → 실제 유동성 확인 후 결정
- max_entries_per_cycle은 라이브에서도 30 유지 가능
