# F-025: NBA $100/ì¼ ìˆ˜ìµ ê²€ì¦ â€” 5ì¼ ìŠ¤í”„ë¦°íŠ¸ (2/13-2/17)

## Context

F-024 êµ¬í˜„ ì™„ë£Œ(Odds API, Kelly sizing, crypto disable, bankroll mgmt)í–ˆìœ¼ë‚˜ ë“œë¼ì´ëŸ° **0ê±´ íŠ¸ë ˆì´ë“œ** ì‹¤íŒ¨.

**ê·¼ë³¸ ì›ì¸**: ë´‡ ì•„í‚¤í…ì²˜ê°€ "ë§¤ì‹œê°„ ì •ê° í¬ë¦½í†  ë§ˆì¼“ ì˜¤í”ˆ"ì— ë§ì¶°ì ¸ ìˆì–´ NBA ë§ˆì¼“ì„ ë°œê²¬/ì§„ì…í•˜ì§€ ëª»í•¨.
- `event_scheduler.py`ì˜ IDLEâ†’PRE_OPENâ†’SNIPEâ†’COOLDOWN ë£¨í”„ëŠ” ë§¤ì‹œê°„ XX:00 ê¸°ì¤€
- NBA ë§ˆì¼“ì€ ê²½ê¸° 1-7ì¼ ì „ì— ì—´ë¦¬ê³ , ê²Œì„ ì‹œì‘ ì‹œê°„ì€ ë¶ˆê·œì¹™ (19:00-22:30 EST)
- PRE_OPENì—ì„œ `discover_all_sports()` í˜¸ì¶œí•˜ì§€ë§Œ, 48ì‹œê°„ ìœˆë„ìš°ì— NBAê°€ ì—†ìœ¼ë©´ 0ê±´

**ë¦¬ì„œì¹˜ í•µì‹¬ ë°œê²¬**:
- í”„ë¡œ ë§ˆì¼“ë©”ì´ì»¤: Pinnacle ë¼ì¸ ëŒ€ë¹„ 0.5-1.5ì„¼íŠ¸/ì…°ì–´ ì—£ì§€ë¡œ ì›” $60-65K ìˆ˜ìµ
- ìƒìœ„ íŠ¸ë ˆì´ë” "Suburban-Mailbox": 1ì£¼ë§Œì— $1.6M P&L (ê±°ëŒ€ ë°©í–¥ì„± ë² íŒ…, $200K+/í¬ì§€ì…˜)
- NBA ë§ˆì¼“ êµ¬ì¡°: ê²Œì„ë‹¹ 39-49ê°œ ë§ˆì¼“ (ML/Spread/O-U), 0% ìˆ˜ìˆ˜ë£Œ, $1M-3M ìœ ë™ì„±
- í•™ìˆ  ì—°êµ¬: í´ë¦¬ë§ˆì¼“ vs ìŠ¤í¬ì¸ ë¶ í‰ê·  ê°€ê²©ì°¨ ì—†ìŒ, **but** ì‹¤ì‹œê°„ ë¼ì¸ ë¬´ë¹™ì—ì„œ ì¼ì‹œì  ê°­ ì¡´ì¬
- ê³ ë˜ ì „ëµ: ì‹¤ì œ ìŠ¹ë¥  ~53%, **í¬ì§€ì…˜ ì‚¬ì´ì§•ê³¼ ì†ì ˆ**ì´ í•µì‹¬ (ì˜ˆì¸¡ ì•„ë‹˜)

**ëª©í‘œ**: $3,000 ìë³¸, ì¼ $100 ìˆ˜ìµ ê°€ëŠ¥ì„±ì„ 2/17 KSTê¹Œì§€ ê²€ì¦
**í•µì‹¬ ì „ëµ**: ë§¤ì‹œê°„ ìŠ¤ë‚˜ì´í¼ â†’ **NBA ì „ìš© ì—°ì† ëª¨ë‹ˆí„°ë§ + ìŠ¤í¬ì¸ ë¶ ì°¨ìµ íƒì§€**

---

## ì•„í‚¤í…ì²˜ ë³€ê²½: NBA ë…ë¦½ ëª¨ë‹ˆí„°

í˜„ì¬ `event_scheduler.py`ì˜ ë§¤ì‹œê°„ ë£¨í”„ë¥¼ ìˆ˜ì •í•˜ëŠ” ëŒ€ì‹ , **ë³„ë„ ë¹„ë™ê¸° íƒœìŠ¤í¬**ë¡œ NBA ëª¨ë‹ˆí„°ë¥¼ ë³‘ë ¬ ì‹¤í–‰.

```
ê¸°ì¡´ (ìœ ì§€):
  IDLE â†’ PRE_OPEN â†’ SNIPE â†’ COOLDOWN (ë§¤ì‹œê°„, cryptoìš©)

ì‹ ê·œ (ë³‘ë ¬):
  NBA Monitor Loop (5ë¶„ ì£¼ê¸°):
    1. Gamma APIë¡œ NBA ë§ˆì¼“ ê²€ìƒ‰ (next 24h)
    2. Odds APIë¡œ ìŠ¤í¬ì¸ ë¶ ì˜¤ì¦ˆ fetch
    3. ë§ˆì¼“ ë§¤ì¹­ (íŒ€ëª…, Spread/O-U/ML)
    4. ê° ë§¤ì¹­ ë§ˆì¼“: Polymarket ê°€ê²© vs devigged í™•ë¥  ë¹„êµ
    5. edge > threshold â†’ paper trade ê¸°ë¡
    6. ê¸°ì¡´ í¬ì§€ì…˜ settlement ì²´í¬
    7. 5ë¶„ sleep
```

**ì™œ ì´ ì ‘ê·¼**: NBA ë§ˆì¼“ì€ ê²Œì„ ìˆ˜ì‹œê°„ ì „ë¶€í„° ì¡´ì¬í•˜ë©°, ìŠ¤í¬ì¸ ë¶ ë¼ì¸ ë³€ë™ ì‹œ ì¼ì‹œì  ê°€ê²©ì°¨ê°€ ë°œìƒ â†’ 5ë¶„ ì£¼ê¸°ë©´ ì¶©ë¶„íˆ í¬ì°© ê°€ëŠ¥.

---

## êµ¬í˜„ ê³„íš

### Phase 1: NBA ëª¨ë‹ˆí„° ì½”ì–´ (`src/poly24h/strategy/nba_monitor.py`)

**ìƒˆ íŒŒì¼** â€” ë…ë¦½ NBA íŠ¸ë ˆì´ë”© ë£¨í”„

```python
class NBAMonitor:
    """NBA ì—°ì† ëª¨ë‹ˆí„°ë§ â€” ìŠ¤í¬ì¸ ë¶ ë¼ì¸ ëŒ€ë¹„ Polymarket ì°¨ìµ íƒì§€."""

    def __init__(self, odds_client, market_scanner, position_manager, ...):
        self._scan_interval = 300  # 5ë¶„
        self._min_edge = 0.03     # 3% ìµœì†Œ ì—£ì§€
        self._max_per_game = 500  # ê²Œì„ë‹¹ ìµœëŒ€ $500

    async def run_forever(self):
        """5ë¶„ ì£¼ê¸° ë©”ì¸ ë£¨í”„."""
        while True:
            await self._scan_and_trade()
            await asyncio.sleep(self._scan_interval)

    async def _scan_and_trade(self):
        """í•œ ì‚¬ì´í´: ë°œê²¬ â†’ ì˜¤ì¦ˆë¹„êµ â†’ ì§„ì…."""
        # 1. NBA ë§ˆì¼“ ë°œê²¬ (Gamma API)
        nba_markets = await self._discover_nba_markets()

        # 2. ìŠ¤í¬ì¸ ë¶ ì˜¤ì¦ˆ (The Odds API, ìºì‹œ í™œìš©)
        games = await self._odds_client.fetch_nba_odds()

        # 3. ë§¤ì¹­ + ì—£ì§€ ê³„ì‚°
        for market in nba_markets:
            fair_prob = self._odds_client.get_fair_prob_for_market(market, games)
            if fair_prob is None:
                continue

            # 4. Polymarket í˜„ì¬ê°€ ì¡°íšŒ (CLOB orderbook)
            best_ask = await self._fetch_best_ask(market)
            edge = fair_prob - best_ask  # YES side
            edge_no = (1 - fair_prob) - (1 - best_ask)  # NO sideë„ ì²´í¬

            # 5. ì—£ì§€ ìˆìœ¼ë©´ ì§„ì…
            if edge >= self._min_edge:
                await self._enter_paper_trade(market, "YES", best_ask, edge)
            elif edge_no >= self._min_edge:  # NO side
                no_ask = await self._fetch_best_ask_no(market)
                await self._enter_paper_trade(market, "NO", no_ask, edge_no)

    async def _discover_nba_markets(self) -> list[Market]:
        """Gamma APIë¡œ NBA ë§ˆì¼“ ê²€ìƒ‰.

        ê¸°ì¡´ discover_all_sports()ì˜ 48h ìœˆë„ìš° ì¬ì‚¬ìš©í•˜ë˜,
        negRisk ì´ë²¤íŠ¸ í¬í•¨í•˜ì—¬ í™•ì¥ (NBA ë©”ì¸ ë§ˆì¼“ì€ negRiskì¼ ìˆ˜ ìˆìŒ).
        """
```

í•µì‹¬ ì°¨ì´ì :
- ë§¤ì‹œê°„ ì •ê° ì˜ì¡´ ì—†ìŒ â†’ 5ë¶„ ê°„ê²© ë…ë¦½ ì‹¤í–‰
- negRisk ì´ë²¤íŠ¸ë„ ê²€ìƒ‰ (NBA ë©”ì¸ ë§ˆì¼“ì´ negRiskì¼ ìˆ˜ ìˆìŒ)
- YES/NO ì–‘ë°©í–¥ ì—£ì§€ ì²´í¬
- ê²Œì„ë‹¹ $500 íˆ¬ì ìƒí•œ

### Phase 2: ë§ˆì¼“ ë°œê²¬ í™•ì¥ (`market_scanner.py`)

ê¸°ì¡´ `discover_all_sports()`ëŠ” `negRisk=False`ë§Œ í•„í„° â†’ NBA ì£¼ìš” ë§ˆì¼“ ë†“ì¹  ìˆ˜ ìˆìŒ.

```python
async def discover_nba_markets(self, include_neg_risk: bool = True) -> list[Market]:
    """NBA ì „ìš© ë§ˆì¼“ ë°œê²¬ â€” negRisk í¬í•¨ ì˜µì…˜."""
    # end_date í•„í„°: ì˜¤ëŠ˜~ë‚´ì¼ (ê²Œì„ ì‹œì‘ ê¸°ì¤€)
    # slug íŒ¨í„´: nba-*
    # negRisk ì˜µì…˜: Trueë©´ ëª¨ë“  NBA ë§ˆì¼“ í¬í•¨
```

### Phase 3: CLOB ê°€ê²© ì¡°íšŒ (`odds_api.py` í™•ì¥)

í˜„ì¬ `odds_api.py`ëŠ” ìŠ¤í¬ì¸ ë¶ ì˜¤ì¦ˆë§Œ ì²˜ë¦¬. Polymarket ì‹¤ì‹œê°„ ê°€ê²© ë¹„êµ ê¸°ëŠ¥ ì¶”ê°€.

```python
async def fetch_polymarket_price(self, token_id: str) -> float | None:
    """CLOB orderbookì—ì„œ best ask ê°€ê²© ì¡°íšŒ."""
    # ê¸°ì¡´ ClobOrderbookFetcher í™œìš© ê°€ëŠ¥
```

### Phase 4: ì´ë²¤íŠ¸ ìŠ¤ì¼€ì¤„ëŸ¬ í†µí•© (`event_scheduler.py`)

`run()` ë©”ì„œë“œì—ì„œ NBA ëª¨ë‹ˆí„°ë¥¼ ë°±ê·¸ë¼ìš´ë“œ íƒœìŠ¤í¬ë¡œ ì‹¤í–‰.

```python
async def run(self, config) -> None:
    # NBA ëª¨ë‹ˆí„° ë°±ê·¸ë¼ìš´ë“œ ì‹¤í–‰
    nba_task = asyncio.create_task(self._nba_monitor.run_forever())

    # ê¸°ì¡´ ë§¤ì‹œê°„ ë£¨í”„ (cryptoìš©)
    while True:
        ...  # ê¸°ì¡´ ì½”ë“œ ìœ ì§€
```

### Phase 5: ë¦¬í¬íŒ… + ë¶„ì„ (`nba_monitor.py` ë‚´ì¥)

ê° ìŠ¤ìº” ì‚¬ì´í´ ê²°ê³¼ë¥¼ ë¡œê·¸ + JSONìœ¼ë¡œ ê¸°ë¡:

```python
# ë¡œê·¸ í¬ë§·
"NBA SCAN: 45 markets | 7 games | 3 edges found | entered 2 ($85.40)"
"NBA EDGE: Lakers ML YES $0.62 | fair=0.68 | edge=6.0% | size=$42.90 (kelly)"
"NBA SKIP: Celtics Spread $0.51 | fair=0.53 | edge=2.0% < 3.0% min"
```

---

## ìˆ˜ì • ëŒ€ìƒ íŒŒì¼

| íŒŒì¼ | ë³€ê²½ |
|------|------|
| **NEW** `src/poly24h/strategy/nba_monitor.py` | NBA ë…ë¦½ ëª¨ë‹ˆí„° ì½”ì–´ |
| `src/poly24h/strategy/odds_api.py` | Polymarket ê°€ê²© ì¡°íšŒ + ì–‘ë°©í–¥ ì—£ì§€ |
| `src/poly24h/discovery/market_scanner.py` | `discover_nba_markets()` (negRisk í¬í•¨) |
| `src/poly24h/scheduler/event_scheduler.py` | NBA ëª¨ë‹ˆí„° ë°±ê·¸ë¼ìš´ë“œ íƒœìŠ¤í¬ ì‹¤í–‰ |
| **NEW** `tests/test_f025_nba_monitor.py` | ì „ì²´ TDD í…ŒìŠ¤íŠ¸ |

---

## í…ŒìŠ¤íŠ¸ ê³„íš

```
# Phase 1: ì½”ì–´ ë¡œì§
test_nba_monitor_scan_finds_games()      â€” Gamma APIì—ì„œ NBA ë§ˆì¼“ ë°œê²¬
test_nba_monitor_matches_odds()          â€” ìŠ¤í¬ì¸ ë¶ ì˜¤ì¦ˆ â†” í´ë¦¬ë§ˆì¼“ ë§¤ì¹­
test_nba_monitor_calculates_edge()       â€” edge = fair_prob - market_price
test_nba_monitor_yes_and_no_edge()       â€” YES/NO ì–‘ë°©í–¥ ì—£ì§€ ê³„ì‚°
test_nba_monitor_enters_on_edge()        â€” edge >= 3% â†’ paper trade ì§„ì…
test_nba_monitor_skips_low_edge()        â€” edge < 3% â†’ ìŠ¤í‚µ
test_nba_monitor_per_game_limit()        â€” ê²Œì„ë‹¹ $500 ì œí•œ
test_nba_monitor_uses_kelly_sizing()     â€” Kelly criterion ì ìš©

# Phase 2: ë§ˆì¼“ ë°œê²¬
test_discover_nba_includes_neg_risk()    â€” negRisk NBA ë§ˆì¼“ í¬í•¨
test_discover_nba_filters_non_nba()      â€” NBA ì•„ë‹Œ ë§ˆì¼“ ì œì™¸

# Phase 3: í†µí•©
test_nba_monitor_runs_parallel()         â€” ê¸°ì¡´ ë§¤ì‹œê°„ ë£¨í”„ì™€ ë³‘ë ¬ ì‹¤í–‰
test_nba_monitor_settlement()            â€” ê²Œì„ ì¢…ë£Œ í›„ settlement ì²˜ë¦¬
```

---

## ìˆ˜ìµì„± ëª¨ë¸ â€” Suburban-Mailbox ë²¤ì¹˜ë§ˆí¬

### ë²¤ì¹˜ë§ˆí¬ íŠ¸ë ˆì´ë” ë¶„ì„ (0x876426...)
```
P&L: $1,603,584 / Volume: $12,196,466 = 13.2% P&L/Volume
ê¸°ê°„: ~5ì¼ (Feb 9-14) â†’ ì¼ $320K P&L
ì¶”ì • í™œì„± ìë³¸: $500K-$1M (í¬ì§€ì…˜ $124K-$944K ê´€ì°°)
ì „ëµ: ê³ í™•ì‹  ë°©í–¥ì„± ì§‘ì¤‘ ë² íŒ… (3-5ê°œ ë§ˆì¼“ì— $200K+)
```

### ìš°ë¦¬ ëª©í‘œ: ê·¸ì˜ 70% ROI on Volume
```
Suburban-Mailbox P&L/Volume: 13.2%
70% ëª©í‘œ: ~9.2% P&L/Volume

$3K ìë³¸ ê¸°ì¤€:
- ì¼ íˆ¬ì…ëŸ‰ $1,000 (1/3 íšŒì „) Ã— 9.2% = $92/ì¼
- ì¼ íˆ¬ì…ëŸ‰ $1,500 (1/2 íšŒì „) Ã— 9.2% = $138/ì¼
- ì¼ íˆ¬ì…ëŸ‰ $2,000 (2/3 íšŒì „) Ã— 9.2% = $184/ì¼

â†’ ëª©í‘œ: ì¼ $1,000-$1,500 íˆ¬ì…, P&L $90-$140/ì¼
â†’ ì´ë¥¼ ìœ„í•´ Half-Kelly (fraction=0.50) ì ìš© â†’ í¬ì§€ì…˜ $100-300/ê±´
â†’ ì¼ 10-15ê±´ íŠ¸ë ˆì´ë“œ Ã— $100-150 = $1,000-$2,250 íˆ¬ì…ëŸ‰
```

### ë‹¬ì„± ì¡°ê±´
```
1. ì¼ 10ê±´+ NBA íŠ¸ë ˆì´ë“œ (6-8ê²Œì„ Ã— 2-3 ë§ˆì¼“/ê²Œì„)
2. í‰ê·  ì—£ì§€ 4%+ (Pinnacle devig vs Polymarket)
3. ìŠ¹ë¥  53%+ (ì—£ì§€ ë³´ì •)
4. í¬ì§€ì…˜ $100-200/ê±´ (Half-Kelly)
5. ë‹¹ì¼ ê²°ì‚° â†’ ìë³¸ ì¬íˆ¬ì… ê°€ëŠ¥

ë¦¬ìŠ¤í¬: Half-KellyëŠ” ë³€ë™ì„± 2ë°°. ì¼ -$200ë„ ê°€ëŠ¥.
ì•ˆì „ì¥ì¹˜: ì¼ ì†ì‹¤ $300 ë„ë‹¬ ì‹œ ì¤‘ë‹¨ (bankroll 10%)
```

---

## 5ì¼ ìŠ¤í”„ë¦°íŠ¸ íƒ€ì„ë¼ì¸

### Day 1: 2/13 (ëª©) â€” êµ¬í˜„ + ì²« í…ŒìŠ¤íŠ¸
- [ ] `nba_monitor.py` TDD êµ¬í˜„
- [ ] `market_scanner.py` negRisk NBA ë°œê²¬ í™•ì¥
- [ ] `event_scheduler.py` ë°±ê·¸ë¼ìš´ë“œ íƒœìŠ¤í¬ í†µí•©
- [ ] ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ í†µê³¼
- [ ] ì €ë… NBA ê²Œì„ì—ì„œ ì²« ë“œë¼ì´ëŸ° (00:40 UTC / 09:40 KST / 19:40 EST)

### Day 2: 2/14 (ê¸ˆ) â€” ë“œë¼ì´ëŸ° ë¶„ì„ + íŠœë‹
- [ ] Day 1 ë“œë¼ì´ëŸ° ê²°ê³¼ ë¶„ì„ (ì—£ì§€ ë¶„í¬, ë§¤ì¹­ ì •í™•ë„)
- [ ] ë§¤ì¹­ ë¡œì§ ë²„ê·¸ ìˆ˜ì •
- [ ] ì—£ì§€ threshold/Kelly fraction íŠœë‹
- [ ] ì €ë… NBA ê²Œì„ ë“œë¼ì´ëŸ° #2

### Day 3: 2/15 (í† ) â€” í’€ ë°ì´ ë“œë¼ì´ëŸ°
- [ ] Day 2 ê²°ê³¼ ë¶„ì„
- [ ] NBA í† ìš”ì¼ ê²½ê¸° (ì£¼ë¡œ 8-10ê²Œì„) í’€ ì»¤ë²„ë¦¬ì§€
- [ ] P&L ì¤‘ê°„ ì ê²€

### Day 4: 2/16 (ì¼) â€” í’€ ë°ì´ + í™•ì¥ ê²€í† 
- [ ] Day 3 ê²°ê³¼ ë¶„ì„
- [ ] NBA ì¼ìš”ì¼ ê²½ê¸° í’€ ì»¤ë²„ë¦¬ì§€
- [ ] ìë³¸ ì¦ì•¡/ì¶”ê°€ ìŠ¤í¬ì¸  í™•ì¥ í•„ìš”ì„± íŒë‹¨

### Day 5: 2/17 (ì›”) â€” ìµœì¢… ë¶„ì„ + Go/No-Go ê²°ì •
- [ ] 4ì¼ê°„ ëˆ„ì  P&L ë¶„ì„
- [ ] ìŠ¹ë¥ , í‰ê·  ì—£ì§€, ì¼ íŠ¸ë ˆì´ë“œ ìˆ˜ í†µê³„
- [ ] $100/ì¼ ë‹¬ì„± ê²½ë¡œ ëª…í™•í™” (ìë³¸ ì¦ì•¡ or ìŠ¤í¬ì¸  í™•ì¥)
- [ ] Live trading Go/No-Go ê²°ì •

---

## ê²€ì¦ ê¸°ì¤€

| ì§€í‘œ | ìµœì†Œ ê¸°ì¤€ | ëª©í‘œ |
|------|-----------|------|
| ì¼ íŠ¸ë ˆì´ë“œ ìˆ˜ | 5ê±´+ | 10-15ê±´ |
| ì¼ íˆ¬ì…ëŸ‰ | $500+ | $1,000-$1,500 |
| í‰ê·  ì—£ì§€ | 3%+ | 4-5%+ |
| P&L/Volume | 5%+ | 9%+ (ë²¤ì¹˜ë§ˆí¬ 70%) |
| ìŠ¹ë¥  | 52%+ | 55%+ |
| ì¼ P&L | ì–‘ìˆ˜ | $90+/ì¼ |
| ëˆ„ì  P&L (4ì¼) | $50 ì´ìƒ | $360+ |
| NBA ë§ˆì¼“ ë§¤ì¹­ë¥  | 50%+ | 80%+ |
| ë´‡ ê°€ë™ ì•ˆì •ì„± | 24ì‹œê°„ ë¬´ì¤‘ë‹¨ | â€” |
| Kelly ë°©ì‹ | Half-Kelly (0.50) | â€” |
| ì¼ ì†ì‹¤ í•œë„ | -$300 (10%) | ë„ë‹¬ ì‹œ ìë™ ì¤‘ë‹¨ |

---

## ì‚¬ì „ ì¡°ê±´

- âœ… The Odds API í‚¤ ë³´ìœ 
- âœ… F-024 êµ¬í˜„ ì™„ë£Œ (odds_api.py, Kelly sizing, bankroll mgmt)
- âœ… ë±…í¬ë¡¤ $3,000 ë¦¬ì…‹ ì™„ë£Œ
- âœ… ì„œë¹„ìŠ¤ setsidë¡œ ì•ˆì •ì  ì‹¤í–‰
- ğŸ”² NBA negRisk ë§ˆì¼“ êµ¬ì¡° í™•ì¸ í•„ìš” (Gamma API ì‹¤ ë°ì´í„°)
